import google.generativeai as genai
import streamlit as st
import os

def configure_gemini(api_key):
    genai.configure(api_key=api_key)

def generate_report(news_data, keywords):
    """
    Generates a Summary and Deep Dive report from news data.
    """
    if news_data.empty:
        return "No news data available to generate report."
        
    # Prepare context
    # Limit number of articles to avoid token limits if necessary
    articles_text = ""
    links_ref = []
    
    for idx, row in news_data.iterrows():
        articles_text += f"- [{row['date']}] {row['title']} ({row['source']}): {row['summary']}\n"
        links_ref.append(f"{row['title']} - {row['url']}")
        
    prompt = f"""
    You are a Semiconductor Industry Analyst.
    Keywords of interest: {', '.join(keywords)}
    
    Analyze the following news articles collected from yesterday 12:00 PM to today 6:00 AM (simulated timeframe).
    
    News Articles:
    {articles_text}
    
    Please provide a formatted report with two sections:
    
    ## 1. Daily Summary
    Briefly summarize the key events.
    
    ## 2. Deep Dive Report
    Analyze the implications of these events on the semiconductor supply chain, specifically considering the keywords.
    
    At the end, list the references used.
    """
    
    try:
        model = genai.GenerativeModel('gemini-pro')
        response = model.generate_content(prompt)
        return response.text
    except Exception as e:
        return f"Error generating report: {e}"

